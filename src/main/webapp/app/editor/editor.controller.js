'use strict'

var sampleText="proc surveyselect data=EastHigh method=srs n=15 out=sample1;"
    ;


(function() {
    'use strict';

    angular
        .module('staceyEditorApp')
        .controller('EditorController', EditorController);

    EditorController.$inject = ['$scope', '$state', '$stateParams', 'entity', 'File', 'FileState', '$window'];

    function EditorController ($scope, $state, $stateParams, entity, File, FileState, $window) {
        var vm = this;


        var langTools = ace.require("ace/ext/language_tools");
        var editor = ace.edit("editor");
        editor.setTheme("ace/theme/textmate");
        editor.getSession().setMode("ace/mode/sas");

        var sasCompleter = {
            getCompletions: function (editor, session, pos, prefix, callback) {
                var sasFirstExpList =  ["axis",
                                        "call",
                                        "catname",
                                        "checkpoint execute_always",
                                        "comment",
                                        "data",
                                        "dm",
                                        "endrsubmit",
                                        "endsas",
                                        "filename",
                                        "footnote",
                                        "goptions",
                                        "goption",
                                        "killtask",
                                        "legend",
                                        "libname",
                                        "listtask",
                                        "lock",
                                        "ods",
                                        "option",
                                        "options",
                                        "page",
                                        "pattern",
                                        "proc",
                                        "procedure",
                                        "quit",
                                        "rdisplay",
                                        "resetline",
                                        "rget",
                                        "rsubmit",
                                        "run",
                                        "run cancel",
                                        "sasfile",
                                        "signoff",
                                        "signon",
                                        "skip",
                                        "symbol",
                                        "sysecho",
                                        "systask",
                                        "waitfor",
                                        "%abort",
                                        "%armconv",
                                        "%armend",
                                        "%armgtid",
                                        "%arminit",
                                        "%armjoin",
                                        "%armproc",
                                        "%armstop",
                                        "%armstrt",
                                        "%armupdt",
                                        "%copy",
                                        "%display",
                                        "%do",
                                        "%do %until",
                                        "%do %while",
                                        "%else",
                                        "%end",
                                        "%global",
                                        "%goto",
                                        "%if",
                                        "%include",
                                        "%input",
                                        "%let",
                                        "%list",
                                        "%local",
                                        "%macro",
                                        "%mend",
                                        "%perfend",
                                        "%perfinit",
                                        "%perfstop",
                                        "%perfstrt",
                                        "%put",
                                        "%return",
                                        "%run",
                                        "%symdel",
                                        "%syscall",
                                        "%sysexec",
                                        "%syslput",
                                        "%sysmacdelete",
                                        "%sysmstoreclear",
                                        "%sysrput",
                                        "%until",
                                        "%while",
                                        "%window"
                                        ];

                var sasFirstExpListWithPercent =  ["abort",
                                        "armconv",
                                        "armend",
                                        "armgtid",
                                        "arminit",
                                        "armjoin",
                                        "armproc",
                                        "armstop",
                                        "armstrt",
                                        "armupdt",
                                        "copy",
                                        "display",
                                        "do",
                                        "do %until",
                                        "do %while",
                                        "else",
                                        "end",
                                        "global",
                                        "goto",
                                        "if",
                                        "include",
                                        "input",
                                        "let",
                                        "list",
                                        "local",
                                        "macro",
                                        "mend",
                                        "perfend",
                                        "perfinit",
                                        "perfstop",
                                        "perfstrt",
                                        "put",
                                        "return",
                                        "run",
                                        "symdel",
                                        "syscall",
                                        "sysexec",
                                        "syslput",
                                        "sysmacdelete",
                                        "sysmstoreclear",
                                        "sysrput",
                                        "until",
                                        "while",
                                        "window"
                                        ];

                var expListAfterAxis =  ["caxis=",
                                        "color=",
                                        "ctext=",
                                        "interval=",
                                        "label=",
                                        "label=none",
                                        "length=",
                                        "logbase=",
                                        "logstyle=",
                                        "major=",
                                        "major=none",
                                        "minor=",
                                        "minor=none",
                                        "nobrackets",
                                        "noplane",
                                        "offset=",
                                        "order=",
                                        "origin=",
                                        "reflabel=",
                                        "reflabel=none",
                                        "split=",
                                        "stagger",
                                        "style=",
                                        "value=",
                                        "value=none",
                                        "width="
                                        ];

                var expListAfterData =  ["pgm=",
                                        "view=",
                                        "_null_"
                                        ];

                var expListAfterFilename =  ["align",
                                        "alq=",
                                        "altdest=",
                                        "attach=",
                                        "batchfile=",
                                        "baud=",
                                        "bcc=",
                                        "binary",
                                        "bits=",
                                        "blk=",
                                        "blksize=",
                                        "block",
                                        "blocksize=",
                                        "bom",
                                        "bomfile",
                                        "buffer=",
                                        "burst",
                                        "byte",
                                        "catalog",
                                        "cc=",
                                        "cd=",
                                        "char1=",
                                        "char2=",
                                        "char3=",
                                        "char4=",
                                        "clear",
                                        "client",
                                        "clipbrd",
                                        "close",
                                        "command",
                                        "commport",
                                        "comtimeout=",
                                        "console=",
                                        "content_type=",
                                        "copies=",
                                        "ct=",
                                        "dataclas=",
                                        "dde",
                                        "debug",
                                        "deliverreceipt",
                                        "deq=",
                                        "desc=",
                                        "dest=",
                                        "dir",
                                        "disk",
                                        "disp=",
                                        "drivemap",
                                        "dropnull=",
                                        "dsntype=",
                                        "dsorg=",
                                        "dummy",
                                        "email",
                                        "encoding=",
                                        "eofconnect",
                                        "expires=",
                                        "ext=",
                                        "extension=",
                                        "fac=",
                                        "fcb=",
                                        "filedata=",
                                        "fileext",
                                        "flash=",
                                        "flashc=",
                                        "flow=",
                                        "fold",
                                        "formdef=",
                                        "forms=",
                                        "from=",
                                        "ftp",
                                        "gsfcc=",
                                        "gterm",
                                        "hfs",
                                        "hold",
                                        "host=",
                                        "hostresponselen=",
                                        "hotlink",
                                        "http",
                                        "id=",
                                        "ignoredoseof",
                                        "importance=",
                                        "key=",
                                        "keyvalue=",
                                        "label=",
                                        "library",
                                        "like=",
                                        "list",
                                        "localcache=",
                                        "lockduration=",
                                        "lockinternal=",
                                        "lowcase_memname",
                                        "lrecl=",
                                        "ls",
                                        "lsa",
                                        "lsfile=",
                                        "mbc=",
                                        "mbf=",
                                        "message",
                                        "mget",
                                        "mgmtclas=",
                                        "mod",
                                        "modify=",
                                        "modifyt=",
                                        "mprompt",
                                        "mvs",
                                        "name=",
                                        "namepipe",
                                        "new",
                                        "noblock",
                                        "nobom",
                                        "nobomfile",
                                        "nomount",
                                        "nomvstrans",
                                        "noprompt",
                                        "notab",
                                        "notesdb",
                                        "old",
                                        "optcd=",
                                        "options=",
                                        "outdes=",
                                        "outencoding=",
                                        "outlim=",
                                        "pagedef=",
                                        "parity=",
                                        "parm1=",
                                        "parm2=",
                                        "parm3=",
                                        "parm4=",
                                        "parm5=",
                                        "pass=",
                                        "passive",
                                        "password=",
                                        "path",
                                        "pgm=",
                                        "pipe",
                                        "plotter",
                                        "port=",
                                        "ppass",
                                        "printer",
                                        "prmode=",
                                        "prompt",
                                        "proxy=",
                                        "puser=",
                                        "pw=",
                                        "pwd=",
                                        "rcmd=",
                                        "rconst=",
                                        "readreceipt",
                                        "recfm=",
                                        "reconn=",
                                        "recorg=",
                                        "replyto='",
                                        "retry=",
                                        "reuse",
                                        "rhelp",
                                        "rmulti=",
                                        "rstat",
                                        "s370v",
                                        "s370vs",
                                        "sasxbamw",
                                        "saveuser",
                                        "server",
                                        "sftp",
                                        "shr=",
                                        "socket",
                                        "space=",
                                        "stop=",
                                        "stopclas=",
                                        "subject=",
                                        "subsys=",
                                        "sysout=",
                                        "tape",
                                        "temp",
                                        "terminal",
                                        "termstr=",
                                        "to=",
                                        "type=",
                                        "ucs=",
                                        "ucsver",
                                        "uid=",
                                        "unbuf",
                                        "unit=",
                                        "uprinter",
                                        "url",
                                        "user=",
                                        "verify",
                                        "volcount=",
                                        "volseq=",
                                        "volser=",
                                        "wait=",
                                        "wait_milliseconds=",
                                        "wconst=",
                                        "webdav",
                                        "wmulti="
                                        ];

                var expListAfterFootnote =  ["a=",
                                        "angle=",
                                        "bc=",
                                        "bcolor=",
                                        "bl=yes",
                                        "blank=yes",
                                        "bo=",
                                        "bold",
                                        "box=",
                                        "bs=",
                                        "bspace=",
                                        "c=",
                                        "color=",
                                        "d=",
                                        "draw=",
                                        "f=",
                                        "font=",
                                        "h=",
                                        "height=",
                                        "italic",
                                        "j=",
                                        "justify=",
                                        "la=",
                                        "langle=",
                                        "link=",
                                        "ls=",
                                        "lspace=",
                                        "m=",
                                        "move=",
                                        "r=",
                                        "rotate=",
                                        "u=",
                                        "underlin=",
                                        "wrap"
                                    ];

                var expListAfterGoptions =  ["accessible",
                                        "admgdf",
                                        "altdesc",
                                        "aspect=",
                                        "autocopy",
                                        "autofeed",
                                        "autosize=",
                                        "binding=",
                                        "border",
                                        "cback=",
                                        "cby=",
                                        "cell",
                                        "cells",
                                        "characters",
                                        "charrec=",
                                        "chartype=",
                                        "circlearc=",
                                        "cmap=",
                                        "collate",
                                        "colors=",
                                        "colortype=",
                                        "colours=",
                                        "cols=",
                                        "cpattern=",
                                        "csymbol=",
                                        "ctext=",
                                        "ctitle=",
                                        "dash",
                                        "dashline=",
                                        "dashscale=",
                                        "delay=",
                                        "des=",
                                        "description=",
                                        "dev=",
                                        "devaddr=",
                                        "device=",
                                        "devmap=",
                                        "devopts=",
                                        "devtype=",
                                        "display",
                                        "disposal=",
                                        "drvinit=",
                                        "drvqry",
                                        "drvterm=",
                                        "duplex",
                                        "erase",
                                        "ext=",
                                        "extension=",
                                        "fasttext",
                                        "fby=",
                                        "fcache=",
                                        "fileclose=",
                                        "fileonly",
                                        "fill",
                                        "fillinc=",
                                        "fontres=",
                                        "format=",
                                        "ftext=",
                                        "ftitle=",
                                        "ftrack=",
                                        "gaccess=",
                                        "gclass=",
                                        "gcopies=",
                                        "gddmcopy=",
                                        "gddmn=",
                                        "gddmnickname=",
                                        "gddmt=",
                                        "gddmtoken=",
                                        "gdest",
                                        "gend=",
                                        "gepilog=",
                                        "gforms=",
                                        "goutmode=",
                                        "gprolog=",
                                        "gprotocol=",
                                        "graphrc",
                                        "gsflen",
                                        "gsfmode=",
                                        "gsfname=",
                                        "gsfprompt",
                                        "gsize=",
                                        "gstart=",
                                        "gunit=",
                                        "gwait=",
                                        "gwriter=",
                                        "handshake=",
                                        "hby=",
                                        "header=",
                                        "headerfile=",
                                        "horigin=",
                                        "hostspec=",
                                        "hpos=",
                                        "hsize=",
                                        "htext=",
                                        "htitle=",
                                        "i=",
                                        "iback=",
                                        "id=",
                                        "imageprint",
                                        "imagestyle=",
                                        "interactive=",
                                        "interlaced",
                                        "interpol=",
                                        "iteration=",
                                        "keymap=",
                                        "lcols=",
                                        "lfactor=",
                                        "lrows=",
                                        "noaccessible",
                                        "noadmgdf",
                                        "noaltdesc",
                                        "noautocopy",
                                        "noautofeed",
                                        "noborder",
                                        "nocell",
                                        "nocells",
                                        "nocharacters",
                                        "nocirclearc",
                                        "nocollate",
                                        "nodash",
                                        "nodisplay",
                                        "nodrvqry",
                                        "noerase",
                                        "nofasttext",
                                        "nofileonly",
                                        "nofill",
                                        "nographrc",
                                        "nogsfprompt",
                                        "noimageprint",
                                        "noninterlaced",
                                        "nopclip",
                                        "nopensort",
                                        "nopiefill",
                                        "nopolygonclip",
                                        "nopolygonfill",
                                        "noprompt",
                                        "noreverse",
                                        "norotate",
                                        "noswap",
                                        "nosymbol",
                                        "notransparency",
                                        "nouserinput",
                                        "nov6comp",
                                        "offshadow=",
                                        "paperdest=",
                                        "paperfeed=",
                                        "paperlimit=",
                                        "papersize=",
                                        "papersource=",
                                        "papertype=",
                                        "pclip",
                                        "penmounts=",
                                        "pensort",
                                        "piefill",
                                        "polygonclip",
                                        "polygonfill",
                                        "postgepilog=",
                                        "postgprolog=",
                                        "postgraphn=",
                                        "ppdfile=",
                                        "pregepilog=",
                                        "pregprolog=",
                                        "pregraphn=",
                                        "prompt",
                                        "promptchars=",
                                        "render=",
                                        "renderlib=",
                                        "repaint=",
                                        "reset=",
                                        "reverse",
                                        "rotate",
                                        "rotate=",
                                        "simfont=",
                                        "speed=",
                                        "swap",
                                        "swfontrender=",
                                        "symbol",
                                        "target=",
                                        "targetdevice=",
                                        "transparency",
                                        "trantab=",
                                        "ucc=",
                                        "userinput",
                                        "v6comp",
                                        "vorigin=",
                                        "vpos=",
                                        "vsize=",
                                        "xmax=",
                                        "xpixels=",
                                        "ymax=",
                                        "ypixels="
                                    ];

                var expListAfterLegend =  ["across=",
                                        "cblock=",
                                        "cborder=",
                                        "cframe=",
                                        "colmajor",
                                        "cshadow=",
                                        "down=",
                                        "frame",
                                        "fwidth=",
                                        "label=",
                                        "label=none",
                                        "mode=",
                                        "offset=",
                                        "order=",
                                        "origin=",
                                        "position=",
                                        "repeat=",
                                        "rowmajor",
                                        "shape=",
                                        "split=",
                                        "value="
                                    ];

                var expListAfterLibname = ["\"",
                                        "access",
                                        "access=",
                                        "account=",
                                        "adjust_byte_semantic_column_lengths=",
                                        "adjust_nchar_column_lengths=",
                                        "aggregate=",
                                        "alq=",
                                        "alqmult=",
                                        "aster",
                                        "authdomain=",
                                        "autocommit=",
                                        "base",
                                        "bks=",
                                        "blksize=",
                                        "bl_identity=",
                                        "bl_log=",
                                        "bl_options=",
                                        "bl_port=",
                                        "bl__keepnulls=",
                                        "bmdp",
                                        "buffsize=",
                                        "bulkextract=",
                                        "bulkload=",
                                        "bulkload_port=",
                                        "bulkunload=",
                                        "cachenum=",
                                        "cachesize=",
                                        "cast=",
                                        "cast_overhead_maxpercent=",
                                        "cellprop=",
                                        "clear",
                                        "command_timeout=",
                                        "complete=",
                                        "compress=",
                                        "concur",
                                        "connection=",
                                        "connection_group=",
                                        "connection_timeout=",
                                        "conoptset=",
                                        "con_timeout=",
                                        "copies=",
                                        "cursor_type=",
                                        "cvp",
                                        "cvpbytes=",
                                        "cvpeng=",
                                        "cvpengine=",
                                        "cvpmult=",
                                        "cvpmultiplier=",
                                        "databas=",
                                        "dataclas=",
                                        "datasource=",
                                        "datasrc=",
                                        "db2",
                                        "db=",
                                        "dbclient_max_bytes=",
                                        "dbcommit=",
                                        "dbconinit=",
                                        "dbconterm=",
                                        "dbcreate_table_opts=",
                                        "dbdatasrc=",
                                        "dbgen_name=",
                                        "dbindex=",
                                        "dblibinit=",
                                        "dblibterm=",
                                        "dblink=database-link",
                                        "dbmax_text=",
                                        "dbmstemp=",
                                        "dbnullkeys=",
                                        "dbprompt=",
                                        "dbsaslabel=",
                                        "dbserver_max_bytes=",
                                        "dbsliceparm=",
                                        "db_length_semantics_byte=",
                                        "defer=",
                                        "delete_mult_rows=",
                                        "deq=",
                                        "deqmult=",
                                        "dimension=",
                                        "direct_exe=",
                                        "direct_sql=",
                                        "disp=",
                                        "dltrunchk",
                                        "doc_seqno=",
                                        "domain=",
                                        "ds=",
                                        "dsn=",
                                        "dsntype=",
                                        "enabledirectio",
                                        "enable_bulk=",
                                        "eoc=",
                                        "errlimit=",
                                        "escape_backslash=",
                                        "excel",
                                        "expcolumnlen=",
                                        "extend",
                                        "extendobscounter=",
                                        "fastexport=",
                                        "fastload=",
                                        "fetch_identity=",
                                        "filelocks=",
                                        "filelockwait=",
                                        "fmtlib=",
                                        "formatactive=",
                                        "formatexport=",
                                        "formatlibrary=",
                                        "formatnoreplace=",
                                        "greenplm",
                                        "hadoop",
                                        "hfs",
                                        "hiperspace",
                                        "host=",
                                        "hostname=",
                                        "id=",
                                        "ignore_read_only_columns=",
                                        "in=",
                                        "indent=",
                                        "inencoding=",
                                        "infomaps",
                                        "informix",
                                        "init=",
                                        "init_string=",
                                        "innameonly",
                                        "insertbuff=",
                                        "insert_sql=",
                                        "install=",
                                        "interface=",
                                        "ipaddr=",
                                        "ip_cursor=",
                                        "jmp",
                                        "keyset_size=",
                                        "label=",
                                        "lasr=",
                                        "libid=",
                                        "liboptset=",
                                        "library=",
                                        "liburi=",
                                        "like=",
                                        "linear",
                                        "list",
                                        "localcache=",
                                        "lockduration=",
                                        "locktable=",
                                        "locktime=",
                                        "lockwait=",
                                        "logdb=",
                                        "login_timeout=",
                                        "mappath=",
                                        "max_connects=",
                                        "mbf=",
                                        "mddb",
                                        "memlib",
                                        "meta",
                                        "metacredentials=",
                                        "metaout=",
                                        "metapass=",
                                        "metaport=",
                                        "metareposiroty=",
                                        "metaserver=",
                                        "metauser=",
                                        "mgmtclas=",
                                        "mode=",
                                        "multistmt=",
                                        "multi_datasrc_opt=",
                                        "mysql",
                                        "neoview",
                                        "netezza",
                                        "nodist",
                                        "nodltrunchk",
                                        "noprompt",
                                        "noprompt=",
                                        "odbc",
                                        "odscharset=",
                                        "odsrecsep=",
                                        "odstrantab=",
                                        "oimstart=",
                                        "oledb",
                                        "oledb_services=",
                                        "oracle",
                                        "oracle_73_or_above=",
                                        "or_enable_interrupt=",
                                        "or_upd_nowhere=",
                                        "osiris",
                                        "outencoding=",
                                        "outrep=",
                                        "packetsize=",
                                        "pass=",
                                        "password=",
                                        "path=",
                                        "port=",
                                        "postgres",
                                        "prefetch=",
                                        "preserve_col_names=",
                                        "preserve_map_names=",
                                        "preserve_tab_names=",
                                        "prompt",
                                        "prompt=",
                                        "properties=",
                                        "protocol=",
                                        "provider=",
                                        "provider_string=",
                                        "proxy=",
                                        "proxyhost=",
                                        "proxypassword=",
                                        "proxyport=",
                                        "proxyusername=",
                                        "pw=",
                                        "pwd=",
                                        "qualifier=",
                                        "qualify_rows=",
                                        "query_band=",
                                        "query_timeout=",
                                        "quoted_identifier=",
                                        "quote_char=",
                                        "readbuff=",
                                        "read_isolation_level=",
                                        "read_lock_type=",
                                        "read_mode_wait=",
                                        "read_only=",
                                        "rengine=",
                                        "repempty=",
                                        "repid=",
                                        "repname=",
                                        "repos=",
                                        "repository=",
                                        "required=",
                                        "reread_exposure=",
                                        "rmtview=",
                                        "roptions=\"",
                                        "rowset_size=",
                                        "sapw=",
                                        "sasedoc",
                                        "sasesock",
                                        "sashdat",
                                        "sasioime",
                                        "sasiola",
                                        "schema=",
                                        "server=",
                                        "sessions=",
                                        "show_synonyms=",
                                        "slibref=",
                                        "space=",
                                        "spd",
                                        "spds",
                                        "spool=",
                                        "spss",
                                        "sqlgeneration=",
                                        "sqlsvr",
                                        "sqlview",
                                        "sql_functions=",
                                        "sql_functions_copy=",
                                        "sql_oj_ansi=",
                                        "storeclas=",
                                        "stringdates=",
                                        "sybase",
                                        "sybaseiq",
                                        "sybpw=",
                                        "tablespace=",
                                        "tag=",
                                        "tagset=",
                                        "tdpid=",
                                        "teradata",
                                        "timeout=",
                                        "tpt=",
                                        "trace=",
                                        "tracefile=",
                                        "transfersize=",
                                        "udl=",
                                        "udl_file=",
                                        "uid=",
                                        "unit=",
                                        "updatebuff=",
                                        "update_isolation_level=",
                                        "update_lock_type=",
                                        "update_mode_wait=",
                                        "update_mult_rows=",
                                        "update_sql=",
                                        "usedirectio=",
                                        "user=",
                                        "userid=",
                                        "use_odbc_cl=",
                                        "using=",
                                        "utilconn_transient=",
                                        "v5",
                                        "v5tape",
                                        "v6",
                                        "v604",
                                        "v6tape",
                                        "v7",
                                        "v7tape",
                                        "v8",
                                        "v8tape",
                                        "v9",
                                        "v9tape",
                                        "version=",
                                        "vertica",
                                        "volcount=",
                                        "volser=",
                                        "wait=",
                                        "webdav",
                                        "webpassword=",
                                        "webusername=",
                                        "xml",
                                        "xml92",
                                        "xmlcompress=",
                                        "xmlconcat=",
                                        "xmlconcat=",
                                        "xmlconcatenate=",
                                        "xmldataform=",
                                        "xmldouble=",
                                        "xmlencoding=",
                                        "xmlfileref=",
                                        "xmlmap=",
                                        "xmlmeta=",
                                        "xmlprocess=",
                                        "xmlschema=",
                                        "xmltype=",
                                        "xmlv2",
                                        "xport"
                                        ];

                var expListAfterOds = ["chtml",
                                        "csvall",
                                        "docbook",
                                        "document",
                                        "escapechar=",
                                        "exclude",
                                        "graphics",
                                        "html",
                                        "html3",
                                        "html4",
                                        "htmlcss",
                                        "imode",
                                        "latex",
                                        "layout",
                                        "listing",
                                        "markup",
                                        "noproctitle",
                                        "nousegopt",
                                        "output",
                                        "package",
                                        "path",
                                        "pcl",
                                        "pdf",
                                        "phtml",
                                        "printer",
                                        "proclabel",
                                        "proctitle",
                                        "ps",
                                        "region",
                                        "results",
                                        "rtf",
                                        "sasreport",
                                        "select",
                                        "tagsets",
                                        "tagsets.rtf",
                                        "text=",
                                        "trace",
                                        "troff",
                                        "usegopt",
                                        "verify",
                                        "wml",
                                        "wmlolist",
                                        "_all_ close"
                                        ];

                var expListAfterOptions = ["animate=",
                                        "animation=",
                                        "animduration=",
                                        "animloop=",
                                        "animoverlay",
                                        "append=",
                                        "appletloc=",
                                        "armagent=",
                                        "armloc=",
                                        "armsubsys=",
                                        "authpd",
                                        "authproviderdomain",
                                        "autocorrect",
                                        "autosaveloc=",
                                        "batch",
                                        "binding=",
                                        "bomfile",
                                        "bottommargin=",
                                        "bufno=",
                                        "bufsize=",
                                        "byerr",
                                        "byline",
                                        "bysorted",
                                        "caps",
                                        "cardimage",
                                        "cbufno=",
                                        "center",
                                        "cgopt=",
                                        "cgoptimize=",
                                        "charcode",
                                        "cleanup",
                                        "cmdmac",
                                        "cmplib=",
                                        "cmpmodel=",
                                        "cmpopt=",
                                        "collate",
                                        "colophon=",
                                        "colorprinting",
                                        "compress=",
                                        "copies=",
                                        "cpucount=",
                                        "cstgloballib=",
                                        "cstsamplelib=",
                                        "datastmtchk=",
                                        "date",
                                        "datestyle=",
                                        "decimalconv=",
                                        "deflate=",
                                        "deflation=",
                                        "details",
                                        "dev=",
                                        "device=",
                                        "dflang=",
                                        "dekricond=",
                                        "dekrocond=",
                                        "dlcreatedir",
                                        "dldmgaction=",
                                        "dmssynchk",
                                        "dqlocale=",
                                        "dqoptions=",
                                        "dqsetuploc=",
                                        "dsnferr",
                                        "dtreset",
                                        "duplex",
                                        "emailackwait=",
                                        "emailauthprotocol=",
                                        "emailfrom",
                                        "emailhost=",
                                        "emailid=",
                                        "emailport",
                                        "emailpw=",
                                        "emailutcoffset=",
                                        "errabend",
                                        "errorabend",
                                        "errorbyabend",
                                        "errorcheck=",
                                        "errors=",
                                        "extendobscounter=",
                                        "firstobs=",
                                        "fmterr",
                                        "fmtsearch=",
                                        "fontrendering=",
                                        "fontsloc=",
                                        "formchar=",
                                        "formdlim=",
                                        "forms=",
                                        "fullstimer",
                                        "gismaps=",
                                        "gstyle",
                                        "gwindow",
                                        "ibufno=",
                                        "ibufsize=",
                                        "icon",
                                        "implmac",
                                        "insert=",
                                        "invaliddata=",
                                        "jpegquality=",
                                        "label",
                                        "leftmargin=",
                                        "linesize=",
                                        "locale=",
                                        "lrecl=",
                                        "ls=",
                                        "maps=",
                                        "mautocomploc",
                                        "mautolocdisplay",
                                        "mautolocindes",
                                        "mautosource",
                                        "mcompile",
                                        "mcompilenote",
                                        "mcoverage",
                                        "mcoverageloc=",
                                        "memcache=",
                                        "mergenoby=",
                                        "merror",
                                        "metaconnect=",
                                        "metapass=",
                                        "metaport=",
                                        "metaprotocol=",
                                        "metarepository=",
                                        "metaserver=",
                                        "metaspn=",
                                        "metauser=",
                                        "mexecnote",
                                        "mexecsize=",
                                        "mfile",
                                        "mindelimiter=",
                                        "minoperator",
                                        "missing=",
                                        "mlogic",
                                        "mlogicnest",
                                        "mprint",
                                        "mprintnest",
                                        "mrecall",
                                        "mreplace",
                                        "msglevel=",
                                        "mstored",
                                        "msymtabmax=",
                                        "multenvappl",
                                        "mvarsize=",
                                        "netencrypt",
                                        "netencryptalgorithm=",
                                        "netencryptkeylen=",
                                        "noanimoverlay",
                                        "noasynchio",
                                        "noautocorrect",
                                        "nobatch",
                                        "nobomfile",
                                        "nobyerr",
                                        "nobyline",
                                        "nobysorted",
                                        "nocaps",
                                        "nocardimage",
                                        "nocenter",
                                        "nocharcode",
                                        "nocleanup",
                                        "nocmdmac",
                                        "nocmpopt",
                                        "nocollate",
                                        "nocolorprinting",
                                        "nocpuid",
                                        "nodate",
                                        "nodetails",
                                        "nodlcreatedir",
                                        "nodmssynchk",
                                        "nodsnferr",
                                        "nodtreset",
                                        "noduplex",
                                        "noemailfrom",
                                        "noerrabend",
                                        "noerrorabend",
                                        "noerrorbyabend",
                                        "nofmterr",
                                        "nofullstimer",
                                        "nogstyle",
                                        "nogwindow",
                                        "noicon",
                                        "noimplmac",
                                        "nolabel",
                                        "nomautolocdisplay",
                                        "nomautosource",
                                        "nomcompile",
                                        "nomerror",
                                        "nomexecnote",
                                        "nomfile",
                                        "nominoperator",
                                        "nomlogic",
                                        "nomlogicnest",
                                        "nomprint",
                                        "nomprintnest",
                                        "nomrecall",
                                        "nomreplace",
                                        "nomstored",
                                        "nomultenvappl",
                                        "noovp",
                                        "nopdfaccess",
                                        "nopdfassembly",
                                        "nopdfcomment",
                                        "nopdfcontent",
                                        "nopdfcopy",
                                        "nopdffillin",
                                        "nopresenv",
                                        "noprintmsglist",
                                        "noprtsetforms",
                                        "noquotelenmax",
                                        "noreplace",
                                        "norsasiotranserror",
                                        "noserror",
                                        "nosortequals",
                                        "nosortvalidate",
                                        "nosource",
                                        "nosource2",
                                        "nospool",
                                        "nosqlconstdatetime",
                                        "nosqlremerge",
                                        "nosslclientauth",
                                        "nosslcrlcheck",
                                        "nostimer",
                                        "nosvgautoplay",
                                        "nosvgcontrolbuttons",
                                        "nosvgmagnifybutton",
                                        "nosymbolgen",
                                        "nosyntaxcheck",
                                        "notes",
                                        "nothreads",
                                        "noupc",
                                        "nouprintcompression",
                                        "novnferr",
                                        "noworkterm",
                                        "noxwait",
                                        "number",
                                        "obs=",
                                        "odsdest=",
                                        "odsgraphics=",
                                        "odsstyle=",
                                        "orientation=",
                                        "ovp",
                                        "pageno=",
                                        "pagesize=",
                                        "paperdest=",
                                        "papersize=",
                                        "papersource=",
                                        "parm=",
                                        "parmcards=",
                                        "pdfaccess",
                                        "pdfassembly",
                                        "pdfcomment",
                                        "pdfcontent",
                                        "pdfcopy",
                                        "pdffillin",
                                        "pdfpagelayout=",
                                        "pdfpageview=",
                                        "pdfpassword=",
                                        "pdfprint=",
                                        "pdfpw=",
                                        "pdfsecurity=",
                                        "presenv",
                                        "printerpath=",
                                        "printmsglist",
                                        "prtabortdlgs=",
                                        "prtsetforms",
                                        "ps=",
                                        "quotelenmax",
                                        "replace",
                                        "ruse=",
                                        "rightmargin=",
                                        "rsasiotranserror",
                                        "s2=",
                                        "s2v=",
                                        "s=",
                                        "sasautos=",
                                        "sascontrol=",
                                        "sasmstore=",
                                        "seq=",
                                        "serror",
                                        "skip=",
                                        "sortdup=",
                                        "sortequals",
                                        "sortseq=",
                                        "sortsize=",
                                        "sortvalidate",
                                        "source",
                                        "source2",
                                        "spool",
                                        "sqlconstdatetime",
                                        "sqlreduceputobs=",
                                        "sqlreduceputvalues=",
                                        "sqlreductput=",
                                        "sqlremerge",
                                        "sqlundopolicy=",
                                        "sslcalistloc=",
                                        "sslcertiss=",
                                        "sslcertloc=",
                                        "sslcertserial=",
                                        "sslcertsubj=",
                                        "sslclientauth",
                                        "sslcrlcheck",
                                        "sslcrlloc=",
                                        "sslpvtkeyloc=",
                                        "sslpvtkeypass=",
                                        "stimer",
                                        "stripesize=",
                                        "sumsize=",
                                        "svgautoplay",
                                        "svgcontrolbuttons",
                                        "svgfadein=",
                                        "svgfademode=",
                                        "svgfadeout=",
                                        "svgheight=",
                                        "svgmagnifybutton",
                                        "svgtitle=",
                                        "svgviewbox=",
                                        "svgwidth=",
                                        "svgx=",
                                        "svgy=",
                                        "sumbolgen",
                                        "syntaxcheck",
                                        "sysparm=",
                                        "sysprintfont=",
                                        "textureloc=",
                                        "threads",
                                        "timezone=",
                                        "topmargin=",
                                        "trantab=",
                                        "tz=",
                                        "ubufno=",
                                        "ubufsize=",
                                        "universalprint",
                                        "upc",
                                        "uprintcompression",
                                        "urlencoding=",
                                        "user=",
                                        "uuidcount=",
                                        "validfmtname=",
                                        "validmemname=",
                                        "validvarname=",
                                        "varinitchk=",
                                        "varlenchk=",
                                        "vbufsize=",
                                        "vnferr",
                                        "workterm",
                                        "xsync",
                                        "yearcutoff="
                                        ];

                var expListAfterPattern = ["c=",
                                        "color=",
                                        "color_style=",
                                        "image=",
                                        "imagestyle=",
                                        "r=",
                                        "repeat=",
                                        "v=",
                                        "value=",
                                        "value=empty",
                                        "value=mdensity<style<angle>>",
                                        "value=mempty",
                                        "value=msolid",
                                        "value=pdensity<style<angle>>",
                                        "value=pempty",
                                        "value=psolid",
                                        "value=solid",
                                        "value=style<density>"
                                        ];

                var expListAfterProc = ["access",
                                        "aceplus",
                                        "adaptivereg",
                                        "allele",
                                        "anom",
                                        "anova",
                                        "append",
                                        "arima",
                                        "authlib",
                                        "autoreg",
                                        "bom",
                                        "boxplot",
                                        "btl",
                                        "calendar",
                                        "calis",
                                        "callrfc",
                                        "cancorr",
                                        "candisc",
                                        "capability",
                                        "casecontrol",
                                        "catalog",
                                        "catmode",
                                        "chart",
                                        "cimport",
                                        "clp",
                                        "cluster",
                                        "compare",
                                        "computetab",
                                        "contents",
                                        "convert",
                                        "copy",
                                        "corr",
                                        "corresp",
                                        "countreg",
                                        "cpm",
                                        "cport",
                                        "cusum",
                                        "datasets",
                                        "datasource",
                                        "dbf",
                                        "dbload",
                                        "delete",
                                        "dif",
                                        "discrim",
                                        "display",
                                        "distance",
                                        "document",
                                        "dqmatch",
                                        "dqscheme",
                                        "dqsrvadm",
                                        "dqsrvsvc",
                                        "ds2",
                                        "dstrans",
                                        "dtree",
                                        "entropy",
                                        "esm",
                                        "expand",
                                        "explode",
                                        "export",
                                        "factex",
                                        "factor",
                                        "family",
                                        "fastclus",
                                        "fcmp",
                                        "fedsql",
                                        "fmm",
                                        "fontreg",
                                        "forecast",
                                        "format",
                                        "forms",
                                        "freq",
                                        "fsbrowse",
                                        "fsedit",
                                        "fsletter",
                                        "fslist",
                                        "fsview",
                                        "g3d",
                                        "g3grid",
                                        "gam",
                                        "ganno",
                                        "gantt",
                                        "gareabar",
                                        "gbarline",
                                        "gchart",
                                        "gcontour",
                                        "gdevice",
                                        "geneselect",
                                        "genmode",
                                        "geocode",
                                        "gfont",
                                        "gimport",
                                        "ginside",
                                        "gkeymap",
                                        "gkpi",
                                        "glimmix",
                                        "glm",
                                        "glmmod",
                                        "glmpower",
                                        "glmselect",
                                        "gmap",
                                        "goptions",
                                        "gplot",
                                        "gproject",
                                        "gradar",
                                        "greduce",
                                        "gremove",
                                        "greplay",
                                        "groovy",
                                        "gslide",
                                        "gtestit",
                                        "gtile",
                                        "hadoop",
                                        "haplotype",
                                        "hp4score",
                                        "hpbin",
                                        "hpcorr",
                                        "hpcountreg",
                                        "hpdecide",
                                        "hpdmdb",
                                        "hpdmdb",
                                        "hpds2",
                                        "hpf",
                                        "hpfarimaspec",
                                        "hpfdiagnose",
                                        "hpfengine",
                                        "hpfesmspec",
                                        "hpfevents",
                                        "hpfexmspec",
                                        "hpfidmspec",
                                        "hpforest",
                                        "hpfselect",
                                        "hpfucmspec",
                                        "hpgenselect",
                                        "hpimpute",
                                        "hplmixed",
                                        "hplogistic",
                                        "hplso",
                                        "hpmixed",
                                        "hpneural",
                                        "hpnlin",
                                        "hpnlmod",
                                        "hpqlim",
                                        "hpreduce",
                                        "hpreg",
                                        "hpsample",
                                        "hpseverity",
                                        "hpsplit",
                                        "hpsummary",
                                        "hptmine",
                                        "hptmscore",
                                        "htsnp",
                                        "http",
                                        "iml",
                                        "import",
                                        "inbreed",
                                        "infomaps",
                                        "intpoints",
                                        "ishikawa",
                                        "json",
                                        "kde",
                                        "krige2d",
                                        "lattice",
                                        "lifereg",
                                        "lifetest",
                                        "loan",
                                        "loess",
                                        "logistic",
                                        "lp",
                                        "macontrol",
                                        "mapimport",
                                        "mcmc",
                                        "mdc",
                                        "mds",
                                        "means",
                                        "metadata",
                                        "mi",
                                        "mianalyze",
                                        "migrate",
                                        "mixed",
                                        "modeclus",
                                        "model",
                                        "multtest",
                                        "nested",
                                        "netdraw",
                                        "netflow",
                                        "nlin",
                                        "nlmixed",
                                        "nlp",
                                        "npar1way",
                                        "olap",
                                        "operate",
                                        "optex",
                                        "optgraph",
                                        "options",
                                        "optload",
                                        "optlp",
                                        "optmilp",
                                        "optmodel",
                                        "optqp",
                                        "optsave",
                                        "orthoreg",
                                        "panel",
                                        "pareto",
                                        "pdlreg",
                                        "phreg",
                                        "plan",
                                        "plm",
                                        "plot",
                                        "pls",
                                        "pm",
                                        "pmenu",
                                        "power",
                                        "presenv",
                                        "princomp",
                                        "prinqual",
                                        "print",
                                        "printto",
                                        "probit",
                                        "proto",
                                        "prtdef",
                                        "prtexp",
                                        "psmooth",
                                        "pwencode",
                                        "qdevice",
                                        "qlim",
                                        "quantlife",
                                        "quantreg",
                                        "quantselect",
                                        "rank",
                                        "reg",
                                        "registry",
                                        "reliability",
                                        "report",
                                        "robustreg",
                                        "rsreg",
                                        "scaproc",
                                        "score",
                                        "seqdesign",
                                        "seqtest",
                                        "server",
                                        "severity",
                                        "sgdesign",
                                        "sgpanel",
                                        "sgplot",
                                        "sgrender",
                                        "sgscatter",
                                        "shewhart",
                                        "sim2d",
                                        "similarity",
                                        "simlin",
                                        "simnormal",
                                        "soap",
                                        "sort",
                                        "spectra",
                                        "sql",
                                        "standard",
                                        "statespace",
                                        "stdize",
                                        "stdrate",
                                        "stepdisc",
                                        "stp",
                                        "stream",
                                        "summary",
                                        "surveyfreq",
                                        "surveylogistic",
                                        "surveymeans",
                                        "surveyphreg",
                                        "surveyreg",
                                        "surveyselect",
                                        "syslin",
                                        "tabulate",
                                        "tcalis",
                                        "template",
                                        "timeid",
                                        "timeplot",
                                        "timeseries",
                                        "tpspline",
                                        "trans",
                                        "transpose",
                                        "transreg",
                                        "trantab",
                                        "tscsreg",
                                        "tspl",
                                        "ttest",
                                        "ucm",
                                        "univariate",
                                        "varclus",
                                        "varcom",
                                        "varioprogram",
                                        "varmax",
                                        "x11",
                                        "x12",
                                        "xsl"
                                        ];

                var expListAfterRsubmit = [
                                        "authdomain=",
                                        "cmacvar=",
                                        "connectpersist=",
                                        "connectremote=",
                                        "connectstatus=",
                                        "connectwait=",
                                        "cpersist=",
                                        "cremote=",
                                        "cscript=",
                                        "cstatus=",
                                        "csysrputsync=",
                                        "cwait=",
                                        "inheritlib=",
                                        "log=",
                                        "macvar=",
                                        "nocscript",
                                        "noscript",
                                        "notify=",
                                        "output=",
                                        "pass=",
                                        "passwd=",
                                        "password=",
                                        "persist=",
                                        "process=",
                                        "pw=",
                                        "pwd=",
                                        "remote=",
                                        "sascmd=",
                                        "script=",
                                        "server=",
                                        "signonwait=",
                                        "status=",
                                        "subject=",
                                        "sysrputsync=",
                                        "uid=",
                                        "user=",
                                        "userid=",
                                        "username=",
                                        "wait="
                                        ];

                var expListAfterSignoff = [
                                        "cmacvar=",
                                        "connectremote=",
                                        "cremote=",
                                        "cscript=",
                                        "macvar=",
                                        "nocscript",
                                        "noscript",
                                        "process=",
                                        "remote=",
                                        "script=",
                                        "_all_"
                                        ];

                var expListAfterSignon = ["authdomain=",
                                        "cmacvar=",
                                        "connectremote=",
                                        "connectstatus=",
                                        "connectwait=",
                                        "cremote=",
                                        "cscript=",
                                        "cstatus=",
                                        "csysrputsync=",
                                        "cwait=",
                                        "inheritlib=",
                                        "log=",
                                        "macvar=",
                                        "nocscript",
                                        "noscript",
                                        "notify=",
                                        "output=",
                                        "pass=",
                                        "passwd=",
                                        "password=",
                                        "process=",
                                        "pw=",
                                        "pwd=",
                                        "remote=",
                                        "sascmd=",
                                        "script=",
                                        "server=",
                                        "serverv=",
                                        "signonwait=",
                                        "status=",
                                        "subject=",
                                        "sysrputsync=",
                                        "tbufsize=",
                                        "uid=",
                                        "user=",
                                        "userid=",
                                        "username=",
                                        "wait="
                                        ];

                var expListAfterSymbol = ["bwidth=",
                                        "c=",
                                        "ci=",
                                        "ci=_style_",
                                        "co=",
                                        "color=",
                                        "color=_style_",
                                        "cv=",
                                        "cv=_style_",
                                        "f=",
                                        "font=",
                                        "h=",
                                        "height=",
                                        "i=",
                                        "interpol=",
                                        "line=",
                                        "mode=",
                                        "pointlabel",
                                        "pointlabel=",
                                        "pointlabel=none",
                                        "r=",
                                        "repeat=",
                                        "singular=",
                                        "step=",
                                        "v=",
                                        "value=",
                                        "value=none",
                                        "w=",
                                        "width="
                                        ];

                var expListAfterSystask = ["command",
                                        "kill",
                                        "list",
                                        "mname=",
                                        "nowait",
                                        "shell=",
                                        "state",
                                        "status=",
                                        "statvar",
                                        "taskname=",
                                        "wait",
                                        "_all_"
                                        ];

                var expListAfterWaitfor = ["timeout",
                                        "_all_",
                                        "_any_"
                                        ];

                var completersList = [];
                var currline = editor.getSelectionRange().start.row;
                var wholelinetxt = editor.session.getLine(currline);
                var lineWithoutLeftAndRightSpace = wholelinetxt.trim();
                var lineWithoutLeftSpace = wholelinetxt.trimLeft();
                var lineLastCharacter = wholelinetxt.slice(-1);
                var lineContainsSpaceInTheMiddle = false;
                var lineFinishesWithSpace = false;
                var lineStartsWithPercent = false;

                if (lineWithoutLeftAndRightSpace.indexOf(' ') >= 0) {
                    lineContainsSpaceInTheMiddle = true;
                }
                if (lineLastCharacter.indexOf(' ') >= 0) {
                    lineFinishesWithSpace = true;
                }
                if (lineWithoutLeftSpace.charAt(0) === '%') {
                    lineStartsWithPercent = true;
                }

                if (!lineContainsSpaceInTheMiddle) {
                    if (!lineFinishesWithSpace) {
                        if (!lineStartsWithPercent) {
                            completersList = sasFirstExpList;
                        } else {
                            completersList = sasFirstExpListWithPercent;
                        }
                    } else {
                        if (lineWithoutLeftAndRightSpace === 'axis') {
                            completersList = expListAfterAxis;
                        }
                        if (lineWithoutLeftAndRightSpace === 'data') {
                            completersList = expListAfterData;
                        }
                        if (lineWithoutLeftAndRightSpace === 'filename') {
                            completersList = expListAfterFilename;
                        }
                        if (lineWithoutLeftAndRightSpace === 'footnote') {
                            completersList = expListAfterFootnote;
                        }
                        if (lineWithoutLeftAndRightSpace === 'goptions') {
                            completersList = expListAfterGoptions;
                        }
                        if (lineWithoutLeftAndRightSpace === 'legend') {
                            completersList = expListAfterLegend;
                        }
                        if (lineWithoutLeftAndRightSpace === 'libname') {
                            completersList = expListAfterLibname;
                        }
                        if (lineWithoutLeftAndRightSpace === 'ods') {
                            completersList = expListAfterOds;
                        }
                        if (lineWithoutLeftAndRightSpace === 'options') {
                            completersList = expListAfterOptions;
                        }
                        if (lineWithoutLeftAndRightSpace === 'pattern') {
                            completersList = expListAfterPattern;
                        }
                        if (lineWithoutLeftAndRightSpace === 'proc') {
                            completersList = expListAfterProc;
                        }
                        if (lineWithoutLeftAndRightSpace === 'procedure') {
                            completersList = expListAfterProc;
                        }
                        if (lineWithoutLeftAndRightSpace === 'rsubmit') {
                            completersList = expListAfterRsubmit;
                        }
                        if (lineWithoutLeftAndRightSpace === 'signoff') {
                            completersList = expListAfterSignoff;
                        }
                        if (lineWithoutLeftAndRightSpace === 'signon') {
                            completersList = expListAfterSignon;
                        }
                        if (lineWithoutLeftAndRightSpace === 'symbol') {
                            completersList = expListAfterSymbol;
                        }
                        if (lineWithoutLeftAndRightSpace === 'systask') {
                            completersList = expListAfterSystask;
                        }
                        if (lineWithoutLeftAndRightSpace === 'waitfor') {
                            completersList = expListAfterWaitfor;
                        }
                    }
                }

                callback(null, completersList.map(function (sasExp) {
                    return {
                        caption: sasExp,
                        value: sasExp,
                        meta: "language"
                    };
                }));
            }
        }

        langTools.setCompleters([sasCompleter]);

        editor.setOptions({
            enableBasicAutocompletion: true
            //,enableLiveAutocompletion: true
        });

        load();

        function load(){
            editor.session.setValue(sampleText)
            //TODO load entity.filestate.content
        }

        function register () {
            $state.go('register');
        }

        function saveFile() {
            vm.isSaving = true;
            if (vm.file.id !== null) {
                File.update(vm.file, onSaveSuccess, onSaveError);
                FileState.save({
                    fileForStateId : vm.file.id,
                    content : editor.session.getValue(),
                    contentContentType : 'TextBlob',
                }, onSaveSuccess, onSaveError);
            } else {
                File.save(vm.file, onSaveSuccess, onSaveError);
                FileState.save({
                    fileForStateId : vm.file.id,
                    content : editor.session.getValue(),
                    contentContentType : 'Clob',
                }, onSaveSuccess, onSaveError);
            }
        }

        vm.saveFile = saveFile;

        function onSaveSuccess (result) {
            alert('success');
            vm.isSaving = false;
        }

        function onSaveError () {
            alert('error');
            vm.isSaving = false;
        }
    }

})();
